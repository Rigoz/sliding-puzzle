/* +--------------------------------------------+
   |	Sliding Puzzle							         |
   |	by Rigo7								            |
   |	https://github.com/Rigoz/sliding-puzzle	|
   +--------------------------------------------+
*/

function SlidingPuzzle(t){_this=this,_cacheReady=!1,_startOnLoad=!1,_width=0,_height=0,_wrapperClass="."+t.wrapperClass,_elementClass="."+t.elementClass,_playClass="."+t.playButton,_pauseClass="."+t.pauseButton,_resetClass="."+t.resetButton,_activeProperties=t.activeProperties,_inactiveProperties=t.inactiveProperties,_playInterval=t.playInterval>1e3?t.playInterval:1e3,_intervalHandler=null,_transitionDuration=_playInterval<t.animDuration?500:t.animDuration,_state=0,_tileIsMoving=!1,_introPlayed=!1,_lastMove=moveDirection.NONE,_coverImage=t.coverBackgroundURL,_tilesImage=t.tilesBackgroundURL,_loaderImage=t.loaderURL,_flipOnVisible=t.flipOnVisible||!1,_pauseOnBlur=t.pauseOnBlur||!0,_rows=t.rows>2?t.rows:2,_columns=t.columns>2?t.columns:2,_tilesWidth=0,_tilesHeight=0,_tilesNumber=_rows*_columns,_emptyTileIndex=t.emptyTileIndex>=0?t.emptyTileIndex:0,_defaultEmptyTileIndex=_emptyTileIndex,_backgroundSectionOffsets=[],_tileOffsets=[],_tiles=[],_coverSections=[],_backgroundSections=[],_drag={elem:null,x:0,y:0,state:0,direction:moveDirection.NONE,maxDistance:0,revertOffset:30,lastOffset:null},_touchEvent={startX:0,startY:0,endX:0,endY:0},this.init()}function isOppositeDirection(t,e){return t==moveDirection.UP&&e==moveDirection.DOWN||t==moveDirection.DOWN&&e==moveDirection.UP||t==moveDirection.LEFT&&e==moveDirection.RIGHT||t==moveDirection.RIGHT&&e==moveDirection.LEFT?!0:!1}function getIndexByOffset(t,e){var i=-1;return $(_tiles).each(function(o){return Math.round($(this).position().top)==Math.round(t)&&Math.round($(this).position().left)==Math.round(e)?(i=o,!1):void 0}),i}moveDirection={NONE:0,UP:1,RIGHT:2,DOWN:3,LEFT:4},SlidingPuzzle.prototype.getMovementDirection=function(t){var e=_backgroundSectionOffsets[_emptyTileIndex];if(Math.round(e.top)==Math.round(t.top)){if(t.left<e.left&&Math.round(e.left-t.left)<=Math.ceil(_tilesWidth))return moveDirection.RIGHT;if(t.left>e.left&&Math.round(t.left-e.left)<=Math.ceil(_tilesWidth))return moveDirection.LEFT}else if(Math.round(e.left)==Math.round(t.left)){if(t.top>e.top&&Math.round(t.top-e.top)<=Math.ceil(_tilesHeight))return moveDirection.UP;if(t.top<e.top&&Math.round(e.top-t.top)<=Math.ceil(_tilesHeight))return moveDirection.DOWN}return moveDirection.NONE},SlidingPuzzle.prototype.init=function(){$(_wrapperClass).css("position","relative"),$(_wrapperClass).append('<div class="sliding-puzzle-loader" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 3;"><img style="position: absolute;" src="'+_loaderImage+'"/></div>'),_width=$(_wrapperClass).width(),$(_elementClass).each(function(t){0==t&&(_tilesWidth=$(this).outerWidth(),_tilesHeight=$(this).outerHeight()),_backgroundSectionOffsets.push({top:$(this).position().top,left:$(this).position().left}),_tileOffsets.push({top:$(this).position().top,left:$(this).position().left})}),_height=_tilesHeight*_rows;var t=$(".sliding-puzzle-loader img").height(),e=$(".sliding-puzzle-loader img").width();$(".sliding-puzzle-loader img").css({top:(_height-t)/2+"px",left:(_width-e)/2+"px"});var i=new Image,o=new Image;o.onload=function(){_cacheReady=!0,$(_wrapperClass).append(_this.createTiles()),_this.setElementsCSS(),_this.bindEvents(),(_startOnLoad||!_flipOnVisible)&&(setTimeout(function(){_this.flip()},2*_transitionDuration),_introPlayed=!0)},i.onload=function(){o.src=_tilesImage},i.src=_coverImage},SlidingPuzzle.prototype.bindEvents=function(){this.bindDocumentReady(),this.bindMouseDown(),this.bindMouseMove(),this.bindMouseUp(),this.bindTouchEvents(),this.bindWindowScroll(),this.bindWindowResize(),this.bindWindowBlur(),this.bindConsole()},SlidingPuzzle.prototype.bindMouseDown=function(){$(_tiles).each(function(){$(this).on("mousedown",function(t){return _drag.state||_tileIsMoving||1!=t.which||(_drag.elem=this,_drag.x=t.pageX,_drag.y=t.pageY,_drag.state=1,$(this).css({transition:"none"}),t.preventDefault(),_this.stopAutoPlay()),!1})})},SlidingPuzzle.prototype.bindTouchEvents=function(){$(_tiles).bind("touchstart",function(t){var e=t.originalEvent.changedTouches[0];_touchEvent.startX=e.pageX,_touchEvent.startY=e.pageY,_this.stopAutoPlay(),t.preventDefault()}),$(_tiles).bind("touchend",function(t){var e=t.originalEvent.changedTouches[0];_touchEvent.endX=e.pageX,_touchEvent.endY=e.pageY;var i=_touchEvent.endX-_touchEvent.startX,o=_touchEvent.endY-_touchEvent.startY,n=_this.getMovementDirection($(this).position()),s=_emptyTileIndex,r=!1;Math.abs(i)>Math.abs(o)?i>0&&n==moveDirection.RIGHT?(_emptyTileIndex--,r=!0):0>i&&n==moveDirection.LEFT&&(_emptyTileIndex++,r=!0):o>0&&n==moveDirection.DOWN?(_emptyTileIndex-=_columns,r=!0):0>o&&n==moveDirection.UP&&(_emptyTileIndex+=_columns,r=!0),r&&$(this).css({top:_backgroundSectionOffsets[s].top,left:_backgroundSectionOffsets[s].left}),_touchEvent={startX:0,startY:0,endX:0,endY:0}})},SlidingPuzzle.prototype.bindMouseMove=function(){$(document).on("mousemove",function(t){if(0!=_drag.state&&!_tileIsMoving){t.preventDefault();var e=" ",i=" ",o=$(_drag.elem).position(),n=t.pageX-_drag.x,s=t.pageY-_drag.y;if(_drag.direction==moveDirection.NONE&&null==_drag.lastOffset)switch(_drag.direction=_this.getMovementDirection(o),_drag.direction){case moveDirection.UP:_drag.lastOffset=_backgroundSectionOffsets[_emptyTileIndex+_columns];break;case moveDirection.DOWN:_drag.lastOffset=_backgroundSectionOffsets[_emptyTileIndex-_columns];break;case moveDirection.LEFT:_drag.lastOffset=_backgroundSectionOffsets[_emptyTileIndex+1];break;case moveDirection.RIGHT:_drag.lastOffset=_backgroundSectionOffsets[_emptyTileIndex-1]}var r=_backgroundSectionOffsets[_emptyTileIndex];switch(_drag.direction){case moveDirection.UP:o.top+s>=r.top&&o.top+s<=_drag.lastOffset.top&&(i="+="+s,e="top",_drag.maxDistance=Math.max(_drag.maxDistance-s,_drag.maxDistance));break;case moveDirection.DOWN:o.top+s<=r.top&&o.top+s>=_drag.lastOffset.top&&(i="+="+s,e="top",_drag.maxDistance=Math.max(s-_drag.maxDistance,_drag.maxDistance));break;case moveDirection.LEFT:o.left+n>=r.left&&o.left+n<=_drag.lastOffset.left&&(i="+="+n,e="left",_drag.maxDistance=Math.max(_drag.maxDistance-n,_drag.maxDistance));break;case moveDirection.RIGHT:o.left+n<=r.left&&o.left+n>=_drag.lastOffset.left&&(i="+="+n,e="left",_drag.maxDistance=Math.max(n+_drag.maxDistance,_drag.maxDistance))}$(_drag.elem).css(e,i+"px"),_drag.x=t.pageX,_drag.y=t.pageY}})},SlidingPuzzle.prototype.bindMouseUp=function(){$(document).on("mouseup",function(){if(!_tileIsMoving){var t=_emptyTileIndex,e=0,i=_drag.maxDistance;switch(_drag.direction){case moveDirection.UP:_emptyTileIndex+=_columns,e=_transitionDuration/(_tilesHeight/($(_drag.elem).position().top-_backgroundSectionOffsets[t].top)),i=Math.abs($(_drag.elem).position().top-_drag.lastOffset.top);break;case moveDirection.DOWN:_emptyTileIndex-=_columns,e=_transitionDuration/(_tilesHeight/(_backgroundSectionOffsets[t].top-$(_drag.elem).position().top)),i=Math.abs($(_drag.elem).position().top-_drag.lastOffset.top);break;case moveDirection.RIGHT:_emptyTileIndex--,e=_transitionDuration/(_tilesWidth/(_backgroundSectionOffsets[t].left-$(_drag.elem).position().left)),i=Math.abs($(_drag.elem).position().left-_drag.lastOffset.left);break;case moveDirection.LEFT:_emptyTileIndex++,e=_transitionDuration/(_tilesWidth/($(_drag.elem).position().left-_backgroundSectionOffsets[t].left)),i=Math.abs($(_drag.elem).position().left-_drag.lastOffset.left)}var o=_backgroundSectionOffsets[t].top,n=_backgroundSectionOffsets[t].left;_drag.maxDistance-i>_drag.revertOffset&&(o=_drag.lastOffset.top,n=_drag.lastOffset.left,_emptyTileIndex=t),_drag.direction&&(_tileIsMoving=!0,$(_drag.elem).css({transitionProperty:"top, left",transitionDuration:e+"ms",transitionTimingFunction:"ease",top:o,left:n}),setTimeout(function(){_tileIsMoving=!1},e)),_drag.elem=null,_drag.direction=moveDirection.NONE,_drag.x=0,_drag.y=0,_drag.state=0,_drag.lastOffset=null,_drag.maxDistance=0}})},SlidingPuzzle.prototype.bindWindowScroll=function(){$(window).scroll(function(){var t=$(_wrapperClass).offset().top,e=window.innerHeight,i=$(this).scrollTop();return _flipOnVisible&&!_introPlayed&&_cacheReady&&t>=i&&i+e>t?(setTimeout(function(){_this.flip()},2*_transitionDuration),void(_introPlayed=!0)):void((_introPlayed&&_pauseOnBlur&&t>i+e||t+_height<i)&&_this.stopAutoPlay())})},SlidingPuzzle.prototype.bindWindowBlur=function(){$(window).blur(function(){_this.stopAutoPlay()})},SlidingPuzzle.prototype.bindWindowResize=function(){$(window).resize(function(){var t=$(_wrapperClass).width();t!=_width&&(_backgroundSectionOffsets=[],_tileOffsets=[],_this.stopAutoPlay(),_width=$(_wrapperClass).width(),_emptyTileIndex=_defaultEmptyTileIndex,$(_elementClass).each(function(t){0==t&&(_tilesWidth=$(this).outerWidth(),_tilesHeight=$(this).outerHeight()),_backgroundSectionOffsets.push({top:$(this).position().top,left:$(this).position().left}),_tileOffsets.push({top:$(this).position().top,left:$(this).position().left})}),_height=_tilesHeight*_rows,_tileOffsets.splice(_emptyTileIndex,1),$(_tiles).each(function(t){$(this).css({top:_tileOffsets[t].top,left:_tileOffsets[t].left,width:_tilesWidth,height:_tilesHeight})}),$(_backgroundSections).each(function(t){$(this).css({backgroundSize:_width+"px "+_height+"px",backgroundPosition:-_tileOffsets[t].left+"px "+-_tileOffsets[t].top+"px"})}))})},SlidingPuzzle.prototype.bindConsole=function(){$(_playClass).click(function(){_this.startAutoPlay()}),$(_pauseClass).click(function(){_this.stopAutoPlay()}),$(_resetClass).click(function(){_this.resetGame()})},SlidingPuzzle.prototype.bindDocumentReady=function(){$(document).ready(function(){if(!_cacheReady)return void(_startOnLoad=!0);var t=$(_wrapperClass).offset().top,e=window.innerHeight,i=$(this).scrollTop();($(document).height()<=e||!_flipOnVisible||i+e>t&&t>i)&&(setTimeout(function(){_this.flip()},2*_transitionDuration),_introPlayed=!0)})},SlidingPuzzle.prototype.createTiles=function(){var t=_tilesNumber,e=new Array(t);for(i=0;i<t;i++)e[i]=$('<div class="sliding-puzzle-tile"><div class="sliding-puzzle-flipper"><div class="sliding-puzzle-cover"></div><div class="sliding-puzzle-back"></div></div></div>');return e},SlidingPuzzle.prototype.setElementsCSS=function(){_tiles=$(".sliding-puzzle-tile"),_coverSections=$(".sliding-puzzle-cover"),_backgroundSections=$(".sliding-puzzle-back"),_this.setTilesCSS(),_this.setCoverCSS(),_this.setBackCSS(),$(".sliding-puzzle-loader").remove()},SlidingPuzzle.prototype.setTilesCSS=function(){$(_tiles).each(function(t){$(this).css({position:"absolute",top:_tileOffsets[t].top,left:_tileOffsets[t].left,width:_tilesWidth,height:_tilesHeight,boxSizing:"border-box",perspective:"1000px"})}),$(".sliding-puzzle-flipper").css({transition:_transitionDuration+"ms ",transformStyle:"preserve-3d",position:"relative",boxSizing:"border-box",width:"100%",height:"100%"})},SlidingPuzzle.prototype.setCoverCSS=function(){var t=_coverImage||"none";"none"!=t&&(t="url("+t+")"),$(_coverSections).each(function(e){var i="rotateY(0deg)";e%2&&(i="rotateX(0deg)"),$(this).css({position:"absolute",zIndex:2,top:"0",left:"0",width:"100%",height:"100%",transition:"transform "+_transitionDuration+"ms ease",transformStyle:"preserve-3d",backfaceVisibility:"hidden",boxSizing:"border-box",transform:i,backgroundImage:t,backgroundSize:_width+"px "+_height+"px",backgroundPosition:-_tileOffsets[e].left+"px "+-_tileOffsets[e].top+"px"})})},SlidingPuzzle.prototype.setBackCSS=function(){var t=_tilesImage||"none";"none"!=t&&(t="url("+t+")"),$(_backgroundSections).each(function(e){var i="rotateY(-180deg)";e%2&&(i="rotateX(-180deg)"),$(this).css({position:"absolute",zIndex:1,top:"0",left:"0",width:"100%",height:"100%",transition:_transitionDuration+"ms",transformStyle:"preserve-3d",backfaceVisibility:"hidden",cursor:"pointer",boxSizing:"border-box",transform:i,backgroundImage:t,backgroundSize:_width+"px "+_height+"px",backgroundPosition:-_tileOffsets[e].left+"px "+-_tileOffsets[e].top+"px"})})},SlidingPuzzle.prototype.flip=function(){$(".sliding-puzzle-back").each(function(t){$(this).css({transition:"all "+2*_transitionDuration+"ms ease"}),$(this).css(t%2?{transform:"rotateX(0deg)"}:{transform:"rotateY(0deg)"})}),$(".sliding-puzzle-cover").each(function(t){$(this).css({transition:"all "+2*_transitionDuration+"ms ease"}),$(this).css(t%2?{transform:"rotateX(180deg)"}:{transform:"rotateY(180deg)"})}),setTimeout(function(){$(_coverSections).remove(),$(".sliding-puzzle-tile").eq(_emptyTileIndex).fadeOut(400,function(){$(this).remove(),_tiles=$(".sliding-puzzle-tile"),_backgroundSections=$(".sliding-puzzle-back"),$(_tiles).css({transitionProperty:"top, left",transitionDuration:_transitionDuration+"ms",transitionTimingFunction:"ease"}),_tileOffsets.splice(_emptyTileIndex,1),_this.startAutoPlay()})},2*_transitionDuration)},SlidingPuzzle.prototype.getRandomPositionInset=function(t){if(_lastMove==moveDirection.NONE){var e=Math.floor(Math.random()*t.length);return _lastMove=t[e].direction,t[e].index}for(var i=t.length,o=0;i>o;){if(isOppositeDirection(_lastMove,t[o].direction)){t.splice(o,1);break}o++}var e=Math.floor(Math.random()*t.length);return _lastMove=t[e].direction,t[e].index},SlidingPuzzle.prototype.moveRandomTile=function(){var t=_this.getNextPosition(),e=getIndexByOffset(_backgroundSectionOffsets[t].top,_backgroundSectionOffsets[t].left);_tileIsMoving=!0,$(_tiles).eq(e).css({top:_backgroundSectionOffsets[_emptyTileIndex].top,left:_backgroundSectionOffsets[_emptyTileIndex].left}),setTimeout(function(){_tileIsMoving=!1},_transitionDuration),_emptyTileIndex=t},SlidingPuzzle.prototype.getNextPosition=function(){var t=new Array,e=_emptyTileIndex,i=_rows,o=_columns;return o>e?0==e?t.push({index:e+1,direction:moveDirection.RIGHT},{index:o,direction:moveDirection.DOWN}):e==o-1?t.push({index:e-1,direction:moveDirection.LEFT},{index:e+o,direction:moveDirection.DOWN}):t.push({index:e-1,direction:moveDirection.LEFT},{index:e+o,direction:moveDirection.DOWN},{index:e+1,direction:moveDirection.RIGHT}):e>=o*(i-1)?e==o*(i-1)?t.push({index:e+1,direction:moveDirection.RIGHT},{index:o,direction:moveDirection.UP}):e==o*i-1?t.push({index:e-1,direction:moveDirection.LEFT},{index:e-o,direction:moveDirection.UP}):t.push({index:e-1,direction:moveDirection.LEFT},{index:e-o,direction:moveDirection.UP},{index:e+1,direction:moveDirection.RIGHT}):e%o==0?t.push({index:e-o,direction:moveDirection.UP},{index:e+o,direction:moveDirection.DOWN},{index:e+1,direction:moveDirection.RIGHT}):e%o==o-1?t.push({index:e-1,direction:moveDirection.LEFT},{index:e-o,direction:moveDirection.UP},{index:e+o,direction:moveDirection.DOWN}):t.push({index:e-1,direction:moveDirection.LEFT},{index:e-o,direction:moveDirection.UP},{index:e+1,direction:moveDirection.RIGHT},{index:e+o,direction:moveDirection.DOWN}),_this.getRandomPositionInset(t)},SlidingPuzzle.prototype.startAutoPlay=function(){_state||($(_tiles).css({transitionProperty:"top, left",transitionDuration:_transitionDuration+"ms",transitionTimingFunction:"ease"}),this.toggleConsoleButtons(),this.moveRandomTile(),_intervalHandler=setInterval(this.moveRandomTile,_playInterval),_state=1)},SlidingPuzzle.prototype.stopAutoPlay=function(){_state&&(_lastMove=moveDirection.NONE,this.toggleConsoleButtons(),clearInterval(_intervalHandler),_state=0)},SlidingPuzzle.prototype.resetGame=function(){this.stopAutoPlay(),$(_tiles).each(function(t){$(this).css({top:_tileOffsets[t].top,left:_tileOffsets[t].left})}),_emptyTileIndex=_defaultEmptyTileIndex},SlidingPuzzle.prototype.toggleConsoleButtons=function(){_state?($(_playClass).css(_inactiveProperties),$(_pauseClass).css(_activeProperties)):($(_playClass).css(_activeProperties),$(_pauseClass).css(_inactiveProperties))};